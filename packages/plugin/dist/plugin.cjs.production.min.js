"use strict";var t,e;Object.defineProperty(exports,"__esModule",{value:!0}),function(t){t.fullscreen="fullscreen",t.embed="embed"}(t||(t={}));class s{}!function(t){t.free="free",t.process="process"}(e||(e={}));let a=new class{constructor(){this.status=e.free,this.processTasks=[],this.listeners=new Map,this.callbacks=new Map}callTask(t,e){this.startTask(t),t.taskId=t.type+Date.now();let s=this.callbacks.get(t.taskId);s?s.push(e):this.callbacks.set(t.taskId,[e]),window.parent.postMessage(t,"*")}callMessage(t){window.parent.postMessage(t,"*")}startTask(t){this.status=e.process,this.processTasks.push(t),this.onStarTask&&this.onStarTask(t)}finishTask(t){let s=this.processTasks.find(e=>e.taskId==t),a=this.processTasks.findIndex(e=>e.taskId==t);a>-1&&this.processTasks.splice(a,1),this.onFinishTask&&this.onFinishTask(s),0==this.processTasks.length&&(this.status=e.free)}startEventListener(){this.started||(this.started=!0,window.addEventListener("message",t=>{let e=t.data.taskId,s=t.data.listenerId;if(t.data.command){let s=this.listeners.get(t.data.command);s&&(s.forEach(e=>e.handle(t.data)),this.finishTask(e))}else{{let s=this.callbacks.get(e);s&&s.forEach(e=>e(t.data)),this.finishTask(e)}s&&alert(s)}}))}registerListener(t,e){let s=this.listeners.get(t);s?s.push(e):this.listeners.set(t,[e])}};class n extends s{constructor(t){super(),this.listenerId="calendar"+Date.now(),this.eventStack=[],this.handle=e=>{this.data=e,t(e)},a.started||a.startEventListener(),a.registerListener("test",this)}emit(t){window.frames[0].postMessage({date:t,taskId:this.data.taskId},"*")}startListen(){}}class i extends s{constructor(t){super(),this.listenerId="calendar"+Date.now(),this.eventStack=[],this.handle=e=>{this.data=e,t(e)},a.started||a.startEventListener(),a.registerListener("send-setting",this)}emit(t){window.frames[0].postMessage({date:t,taskId:this.data.taskId},"*")}startListen(){}}var l,d,r,o={__proto__:null,get SubAppLayout(){return t},EventListener:s,get EventBusStatus(){return e},eventBus:a,CalendarEvent:n,SettingEvent:i};!function(t){t.Loading="Loading",t.Finished="Finished",t.Waiting="Waiting"}(l||(l={})),function(t){t.Parallel="Parallel",t.Preload="Preload",t.LazyLoad="LazyLoad",t.InertLoad="InertLoad"}(d||(d={})),function(t){t.LoadingApp="LoadingApp",t.FinishLoading="FinishLoading"}(r||(r={}));class h{constructor(){this.apps=[]}addApps(t){this.apps.push(...t)}loadParallel(){return this.apps.filter(t=>t.loadMethod==d.Parallel)}getPreloadApps(){return this.apps.filter(t=>t.loadMethod==d.Preload)}getInertLoadApps(){return this.apps.filter(t=>t.loadMethod==d.InertLoad)}getLazyLoadApps(){return this.apps.filter(t=>t.loadMethod==d.LazyLoad)}removeApps(...t){t.forEach(t=>{let e=this.apps.findIndex(e=>e.id==t.id);e>-1&&this.apps.splice(e,1)})}setMasterStatus(t){this.getMasterApp().loadStatus=t}setAppStatus(t,e){let s=this.apps.find(e=>e.id==t);s&&(s.loadStatus=e),this.onAppChange&&this.onAppChange(this.apps)}getAppStatus(t){let e=this.apps.find(e=>e.id==t);return e?e.loadStatus:null}getMasterApp(){return this.apps.find(t=>t.isMaster)}}var p={__proto__:null,get ShellStatus(){return r},AppSchell:h,get AppLoadStatus(){return l},get LoadMethod(){return d}};if("child"==window.id){let t=document.getElementById("result");a.startEventListener();let e=document.getElementById("taskNum"),s=document.getElementById("status");a.onStarTask=t=>{e.value=a.processTasks.length+"",s.innerText=a.status},a.onFinishTask=t=>{e.value=a.processTasks.length+"",s.innerText=a.status},window.child={sendMessage:()=>a.callMessage({command:"test",type:"message"}),callTask:()=>a.callTask({command:"test",type:"task"},e=>{t.innerText=e.date})}}if("parent"==window.id){let t=document.getElementById("status"),e=document.getElementById("calender");a.startEventListener(),a.onStarTask=e=>{t.innerText=a.status,alert("开始任务"+e.command)};let s=new n(t=>{e.value="",e.placeholder="显示日期"});window.p={backData:()=>s.emit(new Date(e.value)),removeListener:()=>s.data,displayEventData:()=>alert(JSON.stringify(s.data))}}if("shell-parent"==window.name){let t=document.getElementById("status"),e=document.getElementById("child1_status"),s=document.getElementById("app_num"),n=document.getElementById("app_finish_num");a.startEventListener(),new i(t=>alert("setting"));let r="child1",o="child2",p=new h;p.addApps([{id:"master",url:"http://localhost:3000/test/shell/parent.html",loadMethod:d.Parallel,isMaster:!0},{id:"child1",url:"http://localhost:3000/test/shell/child1.html",loadMethod:d.Preload},{id:"child2",url:"http://localhost:3000/test/shell/child2.html",loadMethod:d.LazyLoad}]),p.onAppChange=t=>{e.innerText=p.getAppStatus(r),s.innerText=p.apps.length+"",n.innerText=p.apps.filter(t=>t.loadStatus==l.Finished).length+""},p.setMasterStatus(l.Finished),t.innerText=l.Finished,window.parent={onChildLoad:t=>{p.setAppStatus(t,l.Finished)},addChild2:()=>{let t=document.createElement("iframe");t.src="http://localhost:3000/test/shell/child2.html",t.onload=()=>{alert("child2 load"),p.setAppStatus(o,l.Finished)},document.body.append(t)}}}"shell-child1"==window.name&&(a.startEventListener(),setTimeout(()=>{a.callMessage({command:"send-setting",type:"message"})},1e3)),exports.ServiceInvoke={__proto__:null,master:{hello:function(){}}},exports.event=o,exports.shell=p,exports.test={__proto__:null};
//# sourceMappingURL=plugin.cjs.production.min.js.map
