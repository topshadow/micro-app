"use strict";var t;function e(t,e){var n,s;t.prototype=Object.create(e.prototype),t.prototype.constructor=t,n=t,s=e,(Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(n,s)}function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}Object.defineProperty(exports,"__esModule",{value:!0}),function(t){t.fullscreen="fullscreen",t.embed="embed"}(t||(t={}));var s,a=function(){};!function(t){t.free="free",t.process="process"}(s||(s={}));var r,i,o,d=new(function(){function t(){this.status=s.free,this.processTasks=[],this.listeners=new Map,this.callbacks=new Map}var e=t.prototype;return e.callTask=function(t,e){this.startTask(t),t.taskId=t.type+Date.now();var n=this.callbacks.get(t.taskId);n?n.push(e):this.callbacks.set(t.taskId,[e]),window.parent.postMessage(t,"*")},e.callMessage=function(t){window.parent.postMessage(t,"*")},e.startTask=function(t){this.status=s.process,this.processTasks.push(t),this.onStarTask&&this.onStarTask(t)},e.finishTask=function(t){var e=this.processTasks.find((function(e){return e.taskId==t})),n=this.processTasks.findIndex((function(e){return e.taskId==t}));n>-1&&this.processTasks.splice(n,1),this.onFinishTask&&this.onFinishTask(e),0==this.processTasks.length&&(this.status=s.free)},e.startEventListener=function(){var t=this;this.started||(this.started=!0,window.addEventListener("message",(function(e){var n=e.data.taskId,s=e.data.listenerId;if(e.data.command){var a=t.listeners.get(e.data.command);a&&(a.forEach((function(t){return t.handle(e.data)})),t.finishTask(n))}else{var r=t.callbacks.get(n);r&&r.forEach((function(t){return t(e.data)})),t.finishTask(n),s&&alert(s)}})))},e.registerListener=function(t,e){var n=this.listeners.get(t);n?n.push(e):this.listeners.set(t,[e])},t}()),l=function(t){function s(e){var s;return(s=t.call(this)||this).listenerId="calendar"+Date.now(),s.eventStack=[],s.handle=function(t){s.data=t,e(t)},d.started||d.startEventListener(),d.registerListener("test",n(s)),s}e(s,t);var a=s.prototype;return a.emit=function(t){window.frames[0].postMessage({date:t,taskId:this.data.taskId},"*")},a.startListen=function(){},s}(a),u=function(t){function s(e){var s;return(s=t.call(this)||this).listenerId="calendar"+Date.now(),s.eventStack=[],s.handle=function(t){s.data=t,e(t)},d.started||d.startEventListener(),d.registerListener("send-setting",n(s)),s}e(s,t);var a=s.prototype;return a.emit=function(t){window.frames[0].postMessage({date:t,taskId:this.data.taskId},"*")},a.startListen=function(){},s}(a),c={__proto__:null,get SubAppLayout(){return t},EventListener:a,get EventBusStatus(){return s},eventBus:d,CalendarEvent:l,SettingEvent:u};!function(t){t.Loading="Loading",t.Finished="Finished",t.Waiting="Waiting"}(r||(r={})),function(t){t.Parallel="Parallel",t.Preload="Preload",t.LazyLoad="LazyLoad",t.InertLoad="InertLoad"}(i||(i={})),function(t){t.LoadingApp="LoadingApp",t.FinishLoading="FinishLoading"}(o||(o={}));var p=function(){function t(){this.apps=[]}var e=t.prototype;return e.addApps=function(t){var e;(e=this.apps).push.apply(e,t)},e.loadParallel=function(){return this.apps.filter((function(t){return t.loadMethod==i.Parallel}))},e.getPreloadApps=function(){return this.apps.filter((function(t){return t.loadMethod==i.Preload}))},e.getInertLoadApps=function(){return this.apps.filter((function(t){return t.loadMethod==i.InertLoad}))},e.getLazyLoadApps=function(){return this.apps.filter((function(t){return t.loadMethod==i.LazyLoad}))},e.removeApps=function(){for(var t=this,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];n.forEach((function(e){var n=t.apps.findIndex((function(t){return t.id==e.id}));n>-1&&t.apps.splice(n,1)}))},e.setMasterStatus=function(t){this.getMasterApp().loadStatus=t},e.setAppStatus=function(t,e){var n=this.apps.find((function(e){return e.id==t}));n&&(n.loadStatus=e),this.onAppChange&&this.onAppChange(this.apps)},e.getAppStatus=function(t){var e=this.apps.find((function(e){return e.id==t}));return e?e.loadStatus:null},e.getMasterApp=function(){return this.apps.find((function(t){return t.isMaster}))},t}(),h={__proto__:null,get ShellStatus(){return o},AppSchell:p,get AppLoadStatus(){return r},get LoadMethod(){return i}};if("child"==window.id){var f=document.getElementById("result");d.startEventListener();var g=document.getElementById("taskNum"),m=document.getElementById("status");d.onStarTask=function(t){g.value=d.processTasks.length+"",m.innerText=d.status},d.onFinishTask=function(t){g.value=d.processTasks.length+"",m.innerText=d.status},window.child={sendMessage:function(){return d.callMessage({command:"test",type:"message"})},callTask:function(){return d.callTask({command:"test",type:"task"},(function(t){f.innerText=t.date}))}}}if("parent"==window.id){var v=document.getElementById("status"),k=document.getElementById("calender");d.startEventListener(),d.onStarTask=function(t){v.innerText=d.status,alert("开始任务"+t.command)};var L=new l((function(t){k.value="",k.placeholder="显示日期"}));window.p={backData:function(){return L.emit(new Date(k.value))},removeListener:function(){return L.data},displayEventData:function(){return alert(JSON.stringify(L.data))}}}if("shell-parent"==window.name){var w=document.getElementById("status"),y=document.getElementById("child1_status"),T=document.getElementById("app_num"),I=document.getElementById("app_finish_num");d.startEventListener(),new u((function(t){return alert("setting")}));var E=new p;E.addApps([{id:"master",url:"http://localhost:3000/test/shell/parent.html",loadMethod:i.Parallel,isMaster:!0},{id:"child1",url:"http://localhost:3000/test/shell/child1.html",loadMethod:i.Preload},{id:"child2",url:"http://localhost:3000/test/shell/child2.html",loadMethod:i.LazyLoad}]),E.onAppChange=function(t){y.innerText=E.getAppStatus("child1"),T.innerText=E.apps.length+"",I.innerText=E.apps.filter((function(t){return t.loadStatus==r.Finished})).length+""},E.setMasterStatus(r.Finished),w.innerText=r.Finished,window.parent={onChildLoad:function(t){E.setAppStatus(t,r.Finished)},addChild2:function(){var t=document.createElement("iframe");t.src="http://localhost:3000/test/shell/child2.html",t.onload=function(){alert("child2 load"),E.setAppStatus("child2",r.Finished)},document.body.append(t)}}}"shell-child1"==window.name&&(d.startEventListener(),setTimeout((function(){d.callMessage({command:"send-setting",type:"message"})}),1e3)),exports.ServiceInvoke={__proto__:null,master:{hello:function(){}}},exports.event=c,exports.shell=h,exports.test={__proto__:null};
//# sourceMappingURL=plugin.cjs.production.min.js.map
