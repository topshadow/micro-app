{"version":3,"file":"plugin.cjs.production.min.js","sources":["../src/service-invoke/master.ts","../src/utils/index.ts","../src/shell/app.ts","../src/shell/app-shell.ts","../src/test/child.ts","../src/test/parent.ts","../src/test/shell/parent.ts","../src/test/shell/child1.ts"],"sourcesContent":["/**\r\n * hello 函数\r\n */\r\nexport function hello() {\r\n\r\n}\r\n/**\r\n * 主服务\r\n */\r\nexport let master = {\r\n    hello\r\n}\r\n\r\n","export interface Task {\r\n\r\n}\r\n\r\nexport enum SubAppLayout {\r\n    fullscreen = 'fullscreen',\r\n    embed = 'embed'\r\n}\r\n\r\nexport interface CommandData {\r\n    taskId?: string;\r\n    type: 'task' | 'message';\r\n    command: 'calender' | 'change-layout' | 'test' | 'send-setting';\r\n    data?: { layout: SubAppLayout }\r\n    /**是否广播 */\r\n    broadcast?: boolean;\r\n\r\n\r\n\r\n}\r\n\r\nexport abstract class EventListener {\r\n    listenerId!: string;\r\n    data: any;\r\n    abstract emit(data: any): void\r\n    abstract handle: Function;\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n/**消息中心状态 */\r\nexport enum EventBusStatus {\r\n    /**空闲 */\r\n    free = \"free\",\r\n    /** 处理中 */\r\n    process = \"process\"\r\n}\r\nexport let eventBus = new class EventBus {\r\n    status: EventBusStatus = EventBusStatus.free;\r\n    onStarTask?: (data: CommandData) => void\r\n    onFinishTask?: (data: CommandData) => void\r\n\r\n    processTasks: CommandData[] = [];\r\n    started!: boolean;\r\n    listeners: Map<string, EventListener[]> = new Map<string, EventListener[]>();\r\n    callbacks: Map<string, Function[]> = new Map<string, Function[]>();\r\n    constructor() {\r\n\r\n    }\r\n\r\n    callTask(event: CommandData, callback: Function) {\r\n        this.startTask(event);\r\n        event.taskId = event.type + Date.now();\r\n\r\n        let callbacks = this.callbacks.get(event.taskId);\r\n        if (callbacks) {\r\n            callbacks.push(callback);\r\n        } else {\r\n            this.callbacks.set(event.taskId, [callback]);\r\n        }\r\n        debugger;\r\n        window.parent.postMessage(event, '*');\r\n    }\r\n    callMessage(event: CommandData) {\r\n        window.parent.postMessage(event, '*');\r\n    }\r\n    startTask(command: CommandData) {\r\n        this.status = EventBusStatus.process;\r\n\r\n        this.processTasks.push(command);\r\n        if (this.onStarTask) {\r\n            this.onStarTask(command)\r\n        }\r\n\r\n    }\r\n\r\n    finishTask(taskId: string) {\r\n        let task = this.processTasks.find(t => t.taskId == taskId);\r\n\r\n        let taskIndex = this.processTasks.findIndex(t => t.taskId == taskId);\r\n        if (taskIndex > -1) this.processTasks.splice(taskIndex, 1);\r\n        if (this.onFinishTask) {\r\n            this.onFinishTask(task)\r\n        }\r\n        debugger;\r\n        if (this.processTasks.length == 0) {\r\n            this.status = EventBusStatus.free;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    startEventListener() {\r\n        if (this.started) return;\r\n        this.started = true;\r\n\r\n        window.addEventListener('message', (msg) => {\r\n            let taskId = msg.data.taskId;\r\n            let listenerId = msg.data.listenerId;\r\n            debugger;\r\n\r\n            /**处理任务 */\r\n            if (msg.data.command) {\r\n                let callbacks = this.listeners.get(msg.data.command);\r\n                if (callbacks) {\r\n                    debugger;\r\n                    callbacks.forEach(c => c.handle(msg.data));\r\n                    this.finishTask(taskId);\r\n                }\r\n                return\r\n\r\n            } else {\r\n                let callbacks = this.callbacks.get(taskId);\r\n                if (callbacks) {\r\n                    callbacks.forEach(c => c(msg.data));\r\n                }\r\n                this.finishTask(taskId)\r\n\r\n            }\r\n\r\n\r\n            if (listenerId) {\r\n                alert(listenerId)\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n    // startCallback() {\r\n    //     window.addEventListener('message', (msg) => {\r\n    //         debugger;\r\n    //         let type = msg.data.command\r\n    //         let callbacks = this.callbacks.get(type);\r\n    //         if (callbacks) {\r\n    //             callbacks.forEach(c => c(msg.data))\r\n    //         }\r\n    //     })\r\n    // }\r\n\r\n\r\n    registerListener(eventType: string, listener: EventListener) {\r\n        let listeners = this.listeners.get(eventType);\r\n        if (listeners) {\r\n            listeners.push(listener);\r\n        } else {\r\n            this.listeners.set(eventType, [listener])\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n}\r\n\r\n\r\nexport class CalendarEvent extends EventListener {\r\n    listenerId: string = 'calendar' + Date.now();\r\n    data: any;\r\n    /**事件堆栈 */\r\n    eventStack: any[] = [];\r\n    emit(date: Date) {\r\n        // alert(JSON.stringify(this.data));\r\n        debugger;\r\n\r\n        window.frames[0].postMessage({ date, taskId: this.data.taskId }, '*');\r\n    }\r\n    handle: Function;\r\n    constructor(handle: Function) {\r\n        super();\r\n        this.handle = (data: CommandData) => { this.data = data; handle(data) };\r\n        if (!eventBus.started) {\r\n            eventBus.startEventListener();\r\n        }\r\n        debugger;\r\n        eventBus.registerListener('test', this);\r\n\r\n    }\r\n\r\n    startListen() {\r\n\r\n    }\r\n    // removeListener() {\r\n    //     let values = eventBus.callbacks\r\n    //     for (let key in values) {\r\n    //         let callbacks = eventBus.callbacks.get(key);\r\n    //         if (callbacks) {\r\n    //             let exsitListener = callbacks.find(c => c.listenerId == this.listenerId);\r\n    //             if (exsitListener) {\r\n    //                 let indexOf = callbacks.indexOf(exsitListener);\r\n    //                 if (indexOf > -1) { callbacks.splice(indexOf, 1) };\r\n    //             }\r\n    //         }\r\n    //     }\r\n\r\n\r\n    // }\r\n\r\n\r\n\r\n}\r\n\r\n\r\n\r\nexport class SettingEvent extends EventListener {\r\n    listenerId: string = 'calendar' + Date.now();\r\n    data: any;\r\n    /**事件堆栈 */\r\n    eventStack: any[] = [];\r\n    emit(date: Date) {\r\n        // alert(JSON.stringify(this.data));\r\n        debugger;\r\n\r\n        window.frames[0].postMessage({ date, taskId: this.data.taskId }, '*');\r\n    }\r\n    handle: Function;\r\n    constructor(handle: Function) {\r\n        super();\r\n        this.handle = (data: CommandData) => { this.data = data; handle(data) };\r\n        if (!eventBus.started) {\r\n            eventBus.startEventListener();\r\n        }\r\n        debugger;\r\n        eventBus.registerListener('send-setting', this);\r\n\r\n    }\r\n\r\n    startListen() {\r\n\r\n    }\r\n    // removeListener() {\r\n    //     let values = eventBus.callbacks\r\n    //     for (let key in values) {\r\n    //         let callbacks = eventBus.callbacks.get(key);\r\n    //         if (callbacks) {\r\n    //             let exsitListener = callbacks.find(c => c.listenerId == this.listenerId);\r\n    //             if (exsitListener) {\r\n    //                 let indexOf = callbacks.indexOf(exsitListener);\r\n    //                 if (indexOf > -1) { callbacks.splice(indexOf, 1) };\r\n    //             }\r\n    //         }\r\n    //     }\r\n\r\n\r\n    // }\r\n\r\n\r\n\r\n}\r\n\r\n","export enum AppLoadStatus {\r\n    Loading = 'Loading',\r\n    Finished = 'Finished',\r\n    Waiting = 'Waiting'\r\n}\r\nexport interface App {\r\n    /**应用的唯一id */\r\n    id: string;\r\n    title?: string;\r\n    /** 地址 */\r\n\r\n    url: string;\r\n    icon?: string;\r\n    description?: string;\r\n    /**应用的加载方式*/\r\n    loadMethod: LoadMethod;\r\n    isMaster?: boolean;\r\n    loadStatus?: AppLoadStatus\r\n\r\n\r\n}\r\nexport enum LoadMethod {\r\n    /**并行加载,加载优先级最高,使用预渲染与主应用同时加载,不易同时过多应用采用进行并行加载,虽然没有网络并发数量限制,但是流量压力过大 */\r\n    Parallel = 'Parallel',\r\n    /** 预加载  采用预加载  在主应用加载完成后，才会进行加载内容 */\r\n    Preload = 'Preload',\r\n    /** 懒加载  除非主动激活,或是调用其服务/命令  才会进行加载 */\r\n    LazyLoad = 'LazyLoad',\r\n    /** 惰性加载 当应用加载的方式为惰性加载时,通常处于禁用状态 */\r\n    InertLoad = 'InertLoad'\r\n}","import { App, AppLoadStatus, LoadMethod } from \"./app\";\r\n\r\nexport enum ShellStatus {\r\n    LoadingApp = 'LoadingApp',\r\n    FinishLoading = 'FinishLoading'\r\n}\r\n\r\n/**\r\n *  应用管理 ,请在主应用中使用\r\n * \r\n * let appShell= new AppSchell();\r\n * 在ssr 中可以使用\r\n * appShell.addApps();\r\n * \r\n * \r\n*/\r\nexport class AppSchell {\r\n    status!: ShellStatus;\r\n    loading: boolean;\r\n    loadingApp: App\r\n    apps: App[] = [];\r\n    masterApp!: App;\r\n    onAppChange?: (apps: App[]) => void;\r\n\r\n    addApps(app_list: App[]) {\r\n        this.apps.push(...app_list);\r\n    }\r\n    /** 获取并行加载app */\r\n    loadParallel() {\r\n        let parallelApps = this.apps.filter(app => app.loadMethod == LoadMethod.Parallel);\r\n        return parallelApps;\r\n    }\r\n    /**\r\n     * 获取预加载app\r\n     */\r\n    getPreloadApps() {\r\n        let parallelApps = this.apps.filter(app => app.loadMethod == LoadMethod.Preload);\r\n        return parallelApps;\r\n    }\r\n\r\n    /**\r\n     * 获取惰性加载app\r\n     * @returns \r\n     */\r\n    getInertLoadApps() {\r\n        let parallelApps = this.apps.filter(app => app.loadMethod == LoadMethod.InertLoad);\r\n        return parallelApps;\r\n    }\r\n    /**获取懒加载apps */\r\n    getLazyLoadApps() {\r\n        let parallelApps = this.apps.filter(app => app.loadMethod == LoadMethod.LazyLoad);\r\n        return parallelApps;\r\n    }\r\n    /**\r\n     * 移除apps\r\n     * @param app_list \r\n     */\r\n    removeApps(...app_list: App[]) {\r\n        app_list.forEach(app => { let indexOf = this.apps.findIndex(a => a.id == app.id); if (indexOf > -1) this.apps.splice(indexOf, 1); })\r\n    }\r\n\r\n    setMasterStatus(appStatus: AppLoadStatus) {\r\n        this.getMasterApp().loadStatus = appStatus;\r\n    }\r\n    setAppStatus(appId: string, loadStatus: AppLoadStatus) {\r\n        let app = this.apps.find(app => app.id == appId);\r\n        if (app) {\r\n            app.loadStatus = loadStatus;\r\n        }\r\n        debugger;\r\n        if (this.onAppChange) {\r\n            this.onAppChange(this.apps);\r\n        }\r\n\r\n    }\r\n    getAppStatus(appId: string) {\r\n        let app = this.apps.find(app => app.id == appId);\r\n\r\n        return app ? app.loadStatus : null;\r\n    }\r\n    getMasterApp() {\r\n        return this.apps.find(app => app.isMaster);\r\n\r\n    }\r\n\r\n\r\n\r\n}","import { CommandData, eventBus } from '../utils/index';\r\n\r\nif ((window as any)['id'] == 'child') {\r\n    let resultEl = document.getElementById('result') as HTMLInputElement;\r\n\r\n    eventBus.startEventListener();\r\n    let taskNumEl = document.getElementById('taskNum') as HTMLInputElement;\r\n    let statusEl = document.getElementById('status') as HTMLInputElement;\r\n\r\n\r\n    eventBus.onStarTask = (data: CommandData) => { taskNumEl.value = eventBus.processTasks.length + ''; statusEl.innerText = eventBus.status }\r\n    eventBus.onFinishTask = (data: CommandData) => { taskNumEl.value = eventBus.processTasks.length + ''; statusEl.innerText = eventBus.status }\r\n    (window as any)['child'] = {\r\n        sendMessage: () => eventBus.callMessage({ command: 'test', type: 'message' }),\r\n        callTask: () => eventBus.callTask({ command: 'test', type: 'task' }, (data) => { debugger; resultEl.innerText = data.date; })\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n","import { CalendarEvent, CommandData, eventBus } from '../utils/index';\r\n// import { AppSchell } from '../shell/index';\r\n\r\nif ((window as any)['id'] == 'parent') {\r\n    let statusEl = document.getElementById('status');\r\n    let calenderEl = document.getElementById('calender') as HTMLInputElement;\r\n\r\n    eventBus.startEventListener();\r\n    eventBus.onStarTask = (cmd: CommandData) => { statusEl.innerText = eventBus.status; alert('开始任务' + cmd.command) };\r\n\r\n    // eventBus.startCallback();\r\n    let eventListen = new CalendarEvent((_: any) => { calenderEl.value = ''; calenderEl.placeholder = '显示日期' });\r\n    // eventBus.registerListener('test', (_: any) => alert('command'));\r\n    (window as any)['p'] = {\r\n        backData: () => eventListen.emit(new Date(calenderEl.value)),\r\n        removeListener: () => eventListen.data,\r\n        displayEventData: () => alert(JSON.stringify(eventListen.data))\r\n    }\r\n\r\n\r\n}\r\n\r\n","import { AppLoadStatus, LoadMethod } from '../../shell';\r\nimport { AppSchell } from '../../shell/app-shell';\r\nimport { CalendarEvent, eventBus, SettingEvent } from '../../utils';\r\n\r\nif (window.name == 'shell-parent') {\r\n    let status = document.getElementById('status');\r\n    let child1_status = document.getElementById('child1_status');\r\n    let app_num = document.getElementById('app_num');\r\n    let app_finish_num = document.getElementById('app_finish_num');\r\n    eventBus.startEventListener();\r\n    new SettingEvent((data: any) => alert(`setting`))\r\n\r\n\r\n    let child1 = 'child1';\r\n    let master = 'master';\r\n    let child2 = 'child2';\r\n\r\n    let appShell = new AppSchell();\r\n    appShell.addApps([\r\n        { id: 'master', url: 'http://localhost:3000/test/shell/parent.html', loadMethod: LoadMethod.Parallel, isMaster: true },\r\n        { id: 'child1', url: 'http://localhost:3000/test/shell/child1.html', loadMethod: LoadMethod.Preload },\r\n        { id: 'child2', url: 'http://localhost:3000/test/shell/child2.html', loadMethod: LoadMethod.LazyLoad },\r\n\r\n    ]);\r\n\r\n    appShell.onAppChange = (apps) => {\r\n        debugger;\r\n        child1_status.innerText = appShell.getAppStatus(child1);\r\n        app_num.innerText = appShell.apps.length + ''\r\n        app_finish_num.innerText = appShell.apps.filter(app => app.loadStatus == AppLoadStatus.Finished).length + ''\r\n\r\n\r\n\r\n    }\r\n\r\n\r\n\r\n    appShell.setMasterStatus(AppLoadStatus.Finished);\r\n    status.innerText = AppLoadStatus.Finished;\r\n\r\n    (window as any)['parent'] = {\r\n        onChildLoad: (appId) => { appShell.setAppStatus(appId, AppLoadStatus.Finished) },\r\n        addChild2: () => {\r\n            let iframe = document.createElement('iframe');\r\n            iframe.src = \"http://localhost:3000/test/shell/child2.html\";\r\n            iframe.onload = () => { alert(`child2 load`); appShell.setAppStatus(child2, AppLoadStatus.Finished) };\r\n            document.body.append(iframe);\r\n\r\n        }\r\n    }\r\n}\r\n\r\nexport let a = {\r\n    name: 'shell-parent'\r\n}","import { eventBus } from '../../utils/index';\r\nif (window.name == 'shell-child1') {\r\n    // alert('child1')\r\n    eventBus.startEventListener();\r\n    setTimeout(() => {\r\n        eventBus.callMessage({ command: 'send-setting', type: 'message' })\r\n\r\n    }, 1000);\r\n}   "],"names":["SubAppLayout","EventBusStatus","EventListener","AppLoadStatus","LoadMethod","ShellStatus","eventBus","EventBus","this","free","Map","_proto","prototype","callTask","event","callback","startTask","taskId","type","Date","now","callbacks","get","push","set","window","parent","postMessage","callMessage","command","status","process","processTasks","onStarTask","finishTask","task","find","t","taskIndex","findIndex","splice","onFinishTask","length","startEventListener","started","addEventListener","msg","data","listenerId","_this","listeners","forEach","c","handle","alert","registerListener","eventType","listener","CalendarEvent","_EventListener","_this2","call","_assertThisInitialized","_inheritsLoose","_proto2","emit","date","frames","startListen","SettingEvent","_EventListener2","_this3","_proto3","AppSchell","addApps","app_list","_this$apps","apps","apply","loadParallel","filter","app","loadMethod","Parallel","getPreloadApps","Preload","getInertLoadApps","InertLoad","getLazyLoadApps","LazyLoad","removeApps","Array","_len","_key","arguments","indexOf","a","id","setMasterStatus","appStatus","getMasterApp","loadStatus","setAppStatus","appId","onAppChange","getAppStatus","isMaster","resultEl","document","getElementById","taskNumEl","statusEl","value","innerText","sendMessage","calenderEl","cmd","eventListen","_","placeholder","backData","removeListener","displayEventData","JSON","stringify","name","child1_status","app_num","app_finish_num","appShell","url","Finished","onChildLoad","addChild2","iframe","createElement","src","onload","body","append","setTimeout","hello"],"mappings":"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"}